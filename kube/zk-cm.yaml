apiVersion: v1
kind: ConfigMap
metadata:
  name: zk-cm
data:
  zoo.cfg: |
    clientPort=2181
    dataDir=/home/altibase/altibase_home/ZookeeperServer/data
    dataLogDir=/home/altibase/altibase_home/ZookeeperServer/log
    tickTime=2000
    initLimit=10
    syncLimit=2000
    server.1=zk-0.zk-hs.default.svc.cluster.local:2888:3888
    server.2=zk-1.zk-hs.default.svc.cluster.local:2888:3888
    server.3=zk-2.zk-hs.default.svc.cluster.local:2888:3888

  zookeeper-ready.sh: |
    OK=$(echo ruok | nc 127.0.0.1 $1)
    if [ "$OK" == "imok" ]; then
        exit 0
    else
        exit 1
    fi
    
  entry_point.sh: |
    #!/bin/bash
    cp /home/altibase/altibase_home/ZookeeperServer/config_map/zoo.cfg /home/altibase/altibase_home/ZookeeperServer/conf/zoo.cfg

    idx=${HONAME##*-}
    idxPlus=$(($idx + 1))
    echo ${idxPlus} > /home/altibase/altibase_home/ZookeeperServer/data/myid
    
    export JAVA_HOME="$JAVA_HOME/../${JDK18_path}"
    /home/altibase/altibase_home/ZookeeperServer/bin/zkServer.sh --config /home/altibase/altibase_home/ZookeeperServer/conf start"
    
    tail -f /dev/null
